<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Jennifer Bryan" />

<meta name="date" content="2016-05-18" />

<title>Read an Excel Sheet</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Read an Excel Sheet</h1>
<h4 class="author"><em>Jennifer Bryan</em></h4>
<h4 class="date"><em>2016-05-18</em></h4>



<p><em>I’m exploring the existing sheet reading functionality, using the vignette format. This is not an actual vignette!</em></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rprojroot)</code></pre></div>
<pre><code>## Warning: package 'rprojroot' was built under R version 3.2.4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">load_all</span>(<span class="kw">find_package_root_file</span>())</code></pre></div>
<pre><code>## Loading rexcel</code></pre>
<p>Peeling the many-layered onion that is <code>rexcel_read()</code> until I get at the XML for a worksheet. Wish me luck.</p>
<p>We’ll work with an example sheet created for <code>googlesheets</code> that has alot of formulas and formatting going.</p>
<p>Objective 1: create a <code>linen::workbook</code> object. Dropping into code inside <code>rexcel_read_workbook()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ff_path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;sheets&quot;</span>, <span class="st">&quot;gs-test-formula-formatting.xlsx&quot;</span>,
                        <span class="dt">package =</span> <span class="st">&quot;rexcel&quot;</span>))</code></pre></div>
<pre><code>## [1] &quot;/Users/jenny/rrr/rexcel/inst/sheets/gs-test-formula-formatting.xlsx&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## enter rexcel_read_workbook()
path &lt;-<span class="st"> </span>ff_path
sheets &lt;-<span class="st"> </span>1L

## this gets info about the files inside the zip archive
dat &lt;-<span class="st"> </span><span class="kw">xlsx_read_workbook</span>(path)
dat$rels   ## ?files in the zip archive?</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## 
##      id          type                target               target_abs
##   &lt;chr&gt;         &lt;chr&gt;                 &lt;chr&gt;                    &lt;chr&gt;
## 1  rId1        styles            styles.xml            xl/styles.xml
## 2  rId2 sharedStrings     sharedStrings.xml     xl/sharedStrings.xml
## 3  rId3     worksheet worksheets/sheet1.xml xl/worksheets/sheet1.xml</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat$sheets ## ?files corresponding to worksheets?</code></pre></div>
<pre><code>##     name sheet_id   state  ref      type                target
## 1 Sheet1        1 visible rId3 worksheet worksheets/sheet1.xml
##                 target_abs
## 1 xl/worksheets/sheet1.xml</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(sheets &lt;-<span class="st"> </span><span class="kw">xlsx_sheet_names</span>(dat)[sheets])</code></pre></div>
<pre><code>## [1] &quot;Sheet1&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(strings &lt;-<span class="st"> </span><span class="kw">xlsx_read_shared_strings</span>(path))</code></pre></div>
<pre><code>##  [1] &quot;integer&quot;           &quot;number_formatted&quot;  &quot;number_rounded&quot;   
##  [4] &quot;character&quot;         &quot;formula&quot;           &quot;formula_formatted&quot;
##  [7] &quot;one&quot;               &quot;three&quot;             &quot;four&quot;             
## [10] &quot;five&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(date_offset &lt;-<span class="st"> </span><span class="kw">xlsx_date_offset</span>(path))</code></pre></div>
<pre><code>## [1] &quot;1899-12-30&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">style_xlsx &lt;-<span class="st"> </span><span class="kw">xlsx_read_style</span>(path)
<span class="kw">str</span>(style_xlsx, <span class="dt">max.level =</span> <span class="dv">1</span>)</code></pre></div>
<pre><code>## List of 7
##  $ fonts         :Classes 'tbl_df', 'tbl' and 'data.frame':  4 obs. of  13 variables:
##  $ fills         :Classes 'tbl_df', 'tbl' and 'data.frame':  2 obs. of  4 variables:
##  $ borders       :Classes 'tbl_df', 'tbl' and 'data.frame':  1 obs. of  19 variables:
##  $ cell_style_xfs:Classes 'tbl_df', 'tbl' and 'data.frame':  1 obs. of  16 variables:
##  $ cell_xfs      :Classes 'tbl_df', 'tbl' and 'data.frame':  16 obs. of  16 variables:
##  $ cell_styles   :Classes 'tbl_df', 'tbl' and 'data.frame':  1 obs. of  6 variables:
##  $ num_fmts      :Classes 'tbl_df', 'tbl' and 'data.frame':  1 obs. of  2 variables:</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(lookup &lt;-<span class="st"> </span>tibble::<span class="kw">data_frame</span>(
  <span class="dt">font    =</span> style_xlsx$cell_xfs$font_id,
  <span class="dt">fill    =</span> style_xlsx$cell_xfs$fill_id,
  <span class="dt">border  =</span> style_xlsx$cell_xfs$border_id,
  <span class="dt">num_fmt =</span> style_xlsx$cell_xfs$num_fmt_id))</code></pre></div>
<pre><code>## Source: local data frame [16 x 4]
## 
##     font  fill border num_fmt
##    &lt;int&gt; &lt;int&gt;  &lt;int&gt;   &lt;int&gt;
## 1      1    NA     NA      NA
## 2      2    NA     NA      NA
## 3      2    NA     NA       4
## 4      2    NA     NA       5
## 5      3    NA     NA      NA
## 6      2    NA     NA      12
## 7      2    NA     NA      11
## 8      2    NA     NA       5
## 9      2    NA     NA      11
## 10     2    NA     NA      12
## 11     4    NA     NA      NA
## 12     2    NA     NA       3
## 13     2    NA     NA      13
## 14     2    NA     NA     165
## 15     2    NA     NA       4
## 16     2    NA     NA       4</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## numeric formatting
n &lt;-<span class="st"> </span><span class="kw">max</span>(style_xlsx$num_fmts$num_format_id)
fmt &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA_character_</span>, n)
fmt[<span class="kw">seq_along</span>(<span class="kw">xlsx_format_codes</span>())] &lt;-<span class="st"> </span><span class="kw">xlsx_format_codes</span>()
fmt[style_xlsx$num_fmts$num_format_id] &lt;-<span class="st"> </span>style_xlsx$num_fmts$format_code
num_fmt &lt;-<span class="st"> </span>tibble::<span class="kw">data_frame</span>(<span class="dt">num_fmt =</span> fmt)
style &lt;-<span class="st"> </span>linen::<span class="kw">linen_style</span>(lookup, <span class="dt">font =</span> style_xlsx$fonts,
                            <span class="dt">fill =</span> style_xlsx$fills,
                            <span class="dt">border =</span> style_xlsx$borders,
                            <span class="dt">num_fmt =</span> num_fmt)

(workbook &lt;-<span class="st"> </span>linen::<span class="kw">workbook</span>(sheets, style, dat$defined_names))</code></pre></div>
<pre><code>## &lt;workbook&gt;
##   Public:
##     add_sheet: function (sheet) 
##     clone: function (deep = FALSE) 
##     defined_names: tbl_df, tbl, data.frame
##     initialize: function (names, style, defined_names) 
##     names: Sheet1
##     sheets: list
##     style: linen_style</code></pre>
<p>Objective 2: Visit and extract information for all requested worksheets.</p>
<p>In this case, I’m just reading the first and only sheet. This loop appears in <code>rexcel_read_workbook()</code> and calls <code>rexcel_read_worksheet()</code> for each requested worksheet. This is the loop and function we eventually exit from and this <code>workbook</code> object is what’s returned.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## enter rexcel_read_worksheet()
## rexcel_read_worksheet(path, s, workbook, dat, strings, style, date_offset)
(sheet &lt;-<span class="st"> </span>sheets[<span class="dv">1</span>])</code></pre></div>
<pre><code>## [1] &quot;Sheet1&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(sheet_idx &lt;-<span class="st"> </span><span class="kw">match</span>(sheet, workbook$names))</code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(sheet_name &lt;-<span class="st"> </span>sheet)</code></pre></div>
<pre><code>## [1] &quot;Sheet1&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(target &lt;-<span class="st"> </span><span class="kw">xlsx_internal_sheet_name</span>(sheet, dat))</code></pre></div>
<pre><code>## [1] &quot;xl/worksheets/sheet1.xml&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(rels &lt;-<span class="st"> </span><span class="kw">xlsx_read_rels</span>(path, target))</code></pre></div>
<pre><code>## Source: local data frame [2 x 4]
## 
##      id      type                            target
##   &lt;chr&gt;     &lt;chr&gt;                             &lt;chr&gt;
## 1  rId1 hyperlink            http://www.google.com/
## 2  rId2   drawing ../drawings/worksheetdrawing1.xml
## Variables not shown: target_abs &lt;chr&gt;.</code></pre>
<p>Now we drop down into a lower-level non-exported function, <code>xlsx_read_sheet()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## enter xlsx_read_sheet()
(file &lt;-<span class="st"> </span><span class="kw">xlsx_internal_sheet_name</span>(sheet_idx, dat))</code></pre></div>
<pre><code>## [1] &quot;xl/worksheets/sheet1.xml&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">xml &lt;-<span class="st"> </span><span class="kw">xlsx_read_file</span>(path, file) ## at last! the xml! w00t!
(ns &lt;-<span class="st"> </span>xml2::<span class="kw">xml_ns</span>(xml)) ## much less w00t now :(</code></pre></div>
<pre><code>## d1    &lt;-&gt; http://schemas.openxmlformats.org/spreadsheetml/2006/main
## r     &lt;-&gt; http://schemas.openxmlformats.org/officeDocument/2006/relationships
## mx    &lt;-&gt; http://schemas.microsoft.com/office/mac/excel/2008/main
## mc    &lt;-&gt; http://schemas.openxmlformats.org/markup-compatibility/2006
## mv    &lt;-&gt; urn:schemas-microsoft-com:mac:vml
## x14   &lt;-&gt; http://schemas.microsoft.com/office/spreadsheetml/2009/9/main
## x14ac &lt;-&gt; http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac
## xm    &lt;-&gt; http://schemas.microsoft.com/office/excel/2006/main</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(merged &lt;-<span class="st"> </span><span class="kw">xlsx_read_merged</span>(xml, ns))</code></pre></div>
<pre><code>## list()</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(view &lt;-<span class="st"> </span><span class="kw">xlsx_ct_worksheet_views</span>(xml, ns))</code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(cols &lt;-<span class="st"> </span><span class="kw">xlsx_ct_cols</span>(xml, ns)) <span class="co"># NOTE: not used yet</span></code></pre></div>
<pre><code>## Source: local data frame [6 x 9]
## 
##   best_fit collapsed custom_width hidden   min   max outline_level style
##      &lt;lgl&gt;     &lt;lgl&gt;        &lt;lgl&gt;  &lt;lgl&gt; &lt;int&gt; &lt;int&gt;         &lt;int&gt; &lt;int&gt;
## 1    FALSE     FALSE         TRUE  FALSE     1     1            NA    NA
## 2    FALSE     FALSE         TRUE  FALSE     2     2            NA    NA
## 3    FALSE     FALSE         TRUE  FALSE     3     3            NA    NA
## 4    FALSE     FALSE         TRUE  FALSE     4     4            NA    NA
## 5    FALSE     FALSE         TRUE  FALSE     5     5            NA    NA
## 6    FALSE     FALSE         TRUE  FALSE     6     6            NA    NA
## Variables not shown: width &lt;dbl&gt;.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## this is where it's at!
(cell_dat &lt;-<span class="st"> </span><span class="kw">xlsx_parse_cells</span>(xml, ns, strings, style, date_offset))</code></pre></div>
<pre><code>## $cells
## Source: local data frame [2,022 x 5]
## 
##      ref style   type formula     value
##    &lt;chr&gt; &lt;int&gt;  &lt;chr&gt;   &lt;chr&gt;    &lt;list&gt;
## 1     A1     2   text    &lt;NA&gt; &lt;chr [1]&gt;
## 2     B1     3   text    &lt;NA&gt; &lt;chr [1]&gt;
## 3     C1     4   text    &lt;NA&gt; &lt;chr [1]&gt;
## 4     D1     2   text    &lt;NA&gt; &lt;chr [1]&gt;
## 5     E1     2   text    &lt;NA&gt; &lt;chr [1]&gt;
## 6     F1     2   text    &lt;NA&gt; &lt;chr [1]&gt;
## 7     A2     2 number    &lt;NA&gt; &lt;dbl [1]&gt;
## 8     B2     3 number    &lt;NA&gt; &lt;dbl [1]&gt;
## 9     C2     4 number    &lt;NA&gt; &lt;dbl [1]&gt;
## 10    D2     2   text    &lt;NA&gt; &lt;chr [1]&gt;
## ..   ...   ...    ...     ...       ...
## 
## $rows
## Source: local data frame [1,000 x 11]
## 
##        r spans     s custom_format    ht hidden custom_height
##    &lt;int&gt; &lt;chr&gt; &lt;int&gt;         &lt;lgl&gt; &lt;dbl&gt;  &lt;lgl&gt;         &lt;lgl&gt;
## 1      1  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 2      2  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 3      3  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 4      4  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 5      5  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 6      6  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 7      7  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 8      8  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 9      9  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 10    10  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## ..   ...   ...   ...           ...   ...    ...           ...
## Variables not shown: outline_level &lt;int&gt;, collapsed &lt;lgl&gt;, thick_top
##   &lt;lgl&gt;, thick_bot &lt;lgl&gt;.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## not even sure what this is
(rows &lt;-<span class="st"> </span>cell_dat$rows)</code></pre></div>
<pre><code>## Source: local data frame [1,000 x 11]
## 
##        r spans     s custom_format    ht hidden custom_height
##    &lt;int&gt; &lt;chr&gt; &lt;int&gt;         &lt;lgl&gt; &lt;dbl&gt;  &lt;lgl&gt;         &lt;lgl&gt;
## 1      1  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 2      2  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 3      3  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 4      4  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 5      5  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 6      6  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 7      7  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 8      8  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 9      9  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## 10    10  &lt;NA&gt;    NA         FALSE    NA  FALSE            NA
## ..   ...   ...   ...           ...   ...    ...           ...
## Variables not shown: outline_level &lt;int&gt;, collapsed &lt;lgl&gt;, thick_top
##   &lt;lgl&gt;, thick_bot &lt;lgl&gt;.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## this is where cells come from  
(cells &lt;-<span class="st"> </span>linen::<span class="kw">cells</span>(cell_dat$cells$ref, cell_dat$cells$style,
                       cell_dat$cells$type, cell_dat$cells$value,
                       cell_dat$cells$formula))</code></pre></div>
<pre><code>## Source: local data frame [2,022 x 12]
## 
##      ref style     value formula   type is_formula is_value is_blank
##    &lt;chr&gt; &lt;int&gt;    &lt;list&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;lgl&gt;    &lt;lgl&gt;    &lt;lgl&gt;
## 1     A1     2 &lt;chr [1]&gt;    &lt;NA&gt;   text      FALSE     TRUE    FALSE
## 2     B1     3 &lt;chr [1]&gt;    &lt;NA&gt;   text      FALSE     TRUE    FALSE
## 3     C1     4 &lt;chr [1]&gt;    &lt;NA&gt;   text      FALSE     TRUE    FALSE
## 4     D1     2 &lt;chr [1]&gt;    &lt;NA&gt;   text      FALSE     TRUE    FALSE
## 5     E1     2 &lt;chr [1]&gt;    &lt;NA&gt;   text      FALSE     TRUE    FALSE
## 6     F1     2 &lt;chr [1]&gt;    &lt;NA&gt;   text      FALSE     TRUE    FALSE
## 7     A2     2 &lt;dbl [1]&gt;    &lt;NA&gt; number      FALSE     TRUE    FALSE
## 8     B2     3 &lt;dbl [1]&gt;    &lt;NA&gt; number      FALSE     TRUE    FALSE
## 9     C2     4 &lt;dbl [1]&gt;    &lt;NA&gt; number      FALSE     TRUE    FALSE
## 10    D2     2 &lt;chr [1]&gt;    &lt;NA&gt;   text      FALSE     TRUE    FALSE
## ..   ...   ...       ...     ...    ...        ...      ...      ...
## Variables not shown: is_bool &lt;lgl&gt;, is_number &lt;lgl&gt;, is_text &lt;lgl&gt;,
##   is_date &lt;lgl&gt;.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## in real life and in other sheets, it's possible comments will be populated
## but not in this sheet
comments &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
<p>Now we gather everything we’ve learned about this worksheet into a <code>linen::worksheet</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(ws &lt;-<span class="st"> </span>linen::<span class="kw">worksheet</span>(sheet_name, cols, rows, cells, merged, view, comments,
                        workbook))</code></pre></div>
<pre><code>## &lt;worksheet: 1000 x 6&gt;
##  : ABCDEF
## 1: aaaaaa
## 2: 000a$$
## 3: 000 $$
## 4: 000a$$
## 5:  00a$$
## 6: 000a $</code></pre>
<p>If we had other sheets to read, that would be done now. Ultimately this <code>workbook</code> is returned.</p>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
